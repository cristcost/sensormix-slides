<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="all" href="theme/css/svg.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<svg>
  <defs>
    <filter id="box-shadow-filter" x="0" y="0">
      <feGaussianBlur stdDeviation="5"/>
      <feOffset dx="10" dy="10"/>
    </filter>
    <marker id="arrow" orient="auto" refX="0" refY="0" style="stroke-linecap:butt;overflow:visible">
      <path 
      d="M 0.5,0 -5,3 -5,-3 z" />
    </marker>
  </defs>
</svg>

<slides class="layout-widescreen">
  
  <slide class="logoslide nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/gdg_firenze_logo.png"></span>
    </article>
  </slide>

  <slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/logo_sensormix_c.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>


  <slide class="segue back-green nobackground">
    <aside class="gdbar"><img src="images/logo_sensormix_c.png"></aside>
    <hgroup class="auto-fadein">
      <h2>SensorMix</h2>
      <h3>Architettura di esempio basata su Servicemix, Camel e GWT</h3>
    </hgroup>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2>Come è composto SensorMix</h2>
      <h3>Architettura interna</h3>
    </hgroup>
    <article>
      <img style="position: absolute;left:50%;margin-left:-340px;margin-top:-50px;" src="images/sensormix_arc_1.png" alt="SensorMix: Architecture" title="SensorMix: Architecture" />
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2>Come è composto SensorMix</h2>
      <h3>Architettura esterna</h3>
    </hgroup>
    <article>
      <img style="position: absolute;left:50%;margin-left:-340px;margin-top:-50px;" src="images/sensormix_arc_2.png" alt="SensorMix: Interfaces" title="SensorMix: Interfaces" />
    </article>
  </slide>

  <slide class="header-green">
    <article class="flexbox vcenter">
      <div>
        <h2 style="font-size:10em;">Demo</h2>
      </div>
    </article>
  </slide>

  <!-- Canonical Data Model -->
  <slide class="segue header-green no-back">
    <aside class="gdbar big-green"><img src="images/sensormix_focus_cdm.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Data Model Bundle</h2>
    </hgroup>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Il Canonical Data Model EIP</h2>
    </hgroup>
    <article>
      <p>Dal libro EIP:</p>
      <div class="build fade">
        <p>“I am designing several applications to work together through Messaging. Each application has its own internal data format.”</p>
        <p>“How can you minimize dependencies when integrating applications that use different data formats?”</p>
        <img src="images/sensormix_cdm_problem.png" alt="Canonical Data Model problem" title="Canonical Data Model problem" />
      </div>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Il Canonical Data Model EIP</h2>
    </hgroup>
    <article class="flexbox vcenter">
      <div>
        <img src="images/sensormix_cdm_eip.png" alt="Example of EIP" title="Example of EIP" />
      </div>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2>Il nostro approccio al CDM</h2>
    </hgroup>
    <article class="build">
      <p>A noi piace l’approccio <b>Java first</b>:</p>
      <ul>
        <li>Modello dati: <b>POJO</b></li>
        <li>Modello servizi: <b>Interfacce Java</b></li>
      </ul>
      <p>Usiamo annotazioni JaxB e JaxWS per generare dal nostro modello gli XML Schema e WSDL.</p>
      <div>
        <p>Troviamo che cominciare dagli oggetti sia più naturale, lineare e agile:</p>
        <ul class="build fade">
          <li>Lo XML Schema finale risulta più pulito</li>
          <li>Si può fare a meno della validazione XML 
            <ul><li>eccezioni Java = XML non valido</li></ul>
          </li>
          <li>Lavorare sulle classi Java è più veloce (per noi che siamo sviluppatori)</li>
        </ul>
      </div>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> POJO annotati JaxB</h2>
    </hgroup>
    <article class="flexbox build fade smaller">
<pre class="prettyprint" data-lang="java">
@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = &quot;SampleReport&quot;)
public class SampleReport implements Serializable {

  /** The sensor id. */
  @XmlAttribute(required = true, name = &quot;sensorId&quot;)
  @XmlSchemaType(name = &quot;anyURI&quot;)
  private String sensorId;

  /** The sample type. */
  @XmlAttribute(required = false, name = &quot;sampleType&quot;)
  private String sampleType;

  /** The daily sample reports. */
  @XmlElement(required = false, name = &quot;dailySampleReport&quot;)
  private List&lt;DailySampleReport&gt; dailySampleReports;

  // ...</pre>
      <img style="position: absolute; top: 100px; right: 50px;" src="images/sensormix_cdm_image_1.png" alt="POJO annotated JaxB" title="POJO annotated JaxB" />
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Interfaccia annotata JaxWS</h2>
    </hgroup>
 <article class="flexbox build fade smaller">
<pre class="prettyprint" data-lang="java">
@WebService(name = &quot;SensormixService&quot;,
    targetNamespace = &quot;http://developers.google.com/gdgfirenze/ns/service&quot;)
@SOAPBinding(parameterStyle = ParameterStyle.WRAPPED, style = Style.DOCUMENT, use = Use.LITERAL)
public interface SensormixService {

  @WebMethod(action = &quot;urn:#listSensorsIds&quot;)
  @RequestWrapper(localName = &quot;listSensorsIdsIn&quot;,
      targetNamespace = &quot;http://developers.google.com/gdgfirenze/ns/service&quot;)
  @ResponseWrapper(localName = &quot;listSensorsIdsOut&quot;,
      targetNamespace = &quot;http://developers.google.com/gdgfirenze/ns/service&quot;)
  @WebResult(name = &quot;sensorId&quot;)
  List&lt;String&gt; listSensorsIds();

  @WebMethod(action = &quot;urn:#listSamplesTypes&quot;)
  @RequestWrapper(localName = &quot;listSamplesTypesIn&quot;,
      targetNamespace = &quot;http://developers.google.com/gdgfirenze/ns/service&quot;)
  @ResponseWrapper(localName = &quot;listSamplesTypesOut&quot;,
      targetNamespace = &quot;http://developers.google.com/gdgfirenze/ns/service&quot;)
  @WebResult(name = &quot;sampleType&quot;)
  List&lt;String&gt; listSamplesTypes();

  // ...</pre>
      <img style="position: absolute; top: 100px; right: 50px;" src="images/sensormix_cdm_image_2.png" alt="Interfaces annotated JaxWS" title="Interfaces annotated JaxWS" />
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Utilizzo del CDM su GWT</h2>
    </hgroup>
    <article class="flexbox vcenter">
      <p>Infine, se si vuole usare il data model anche dentro un progetto GWT, basta aggiungere un modulo .gwt.xml:</p>
      <div class="build fade">
<pre class="prettyprint" data-lang="gwt xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!-- When updating your version of GWT, you should also update this DTD reference, 
        so that your app can take advantage of the latest GWT module capabilities. --&gt;
&lt;!DOCTYPE module PUBLIC &quot;-//Google Inc.//DTD Google Web Toolkit 2.5.1//EN&quot;
  &quot;http://google-web-toolkit.googlecode.com/svn/tags
  /2.5.1/distro-source/core/src/gwt-module.dtd&quot;&gt;
&lt;module&gt;

        &lt;!-- Specify the paths for translatable code --&gt;
        &lt;source path='model' /&gt;
        &lt;source path='service' /&gt;

&lt;/module&gt;</pre>
        <img style="position: absolute; top: 100px; right: 50px;" src="images/sensormix_cdm_image_3.png" alt="Interfaces annotated JaxWS" title="Interfaces annotated JaxWS" />
      </div>
    </article>
  </slide>

  <!-- Data Service -->
  <slide class="segue header-green no-back">
    <aside class="gdbar big-green"><img src="images/sensormix_focus_dataservice.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Data Service Bundle</h2>
    </hgroup>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Il bundle dataservice</h2>
    </hgroup>
    <article>
      <p>Contiene un servizio che espone funzionalità di memorizzazione e recupero di informazioni </p>
      <p>Il servizio viene registrato in OSGi tramite Spring DM</p>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> La registrazione del servizio</h2>
    </hgroup>
    <article>
<pre class="prettyprint" data-lang="spring dm">
&lt;osgix:cm-properties id=&quot;dataSourceProperties&quot;
  persistent-id=&quot;sensormix.jpa.persistenceunit&quot;&gt;
  &lt;prop key=&quot;sensormix_db.driverClassName&quot;&gt;org.hsqldb.jdbcDriver&lt;/prop&gt;
  &lt;prop key=&quot;sensormix_db.url&quot;&gt;jdbc:hsqldb:mem:sensormix_db&lt;/prop&gt;
  &lt;prop key=&quot;sensormix_db.username&quot;&gt;sa&lt;/prop&gt;
  &lt;prop key=&quot;sensormix_db.password&quot;&gt;&lt;/prop&gt;
&lt;/osgix:cm-properties&gt;

&lt;osgi:service ref=&quot;sensormixService&quot;&gt;
  &lt;osgi:interfaces&gt;
    &lt;value&gt;com.google.developers.gdgfirenze.service.SensormixService&lt;/value&gt;
    &lt;value&gt;com.google.developers.gdgfirenze.osgi.SensormixAdminInterface&lt;/value&gt;
  &lt;/osgi:interfaces&gt;
&lt;/osgi:service&gt;
</pre>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Il servizio in java</h2>
    </hgroup>
    <article class="smaller">
<pre class="prettyprint" data-lang="java">
public class SensormixServiceJpaImpl implements SensormixService, SensormixAdminInterface {

  private EntityManagerFactory entityManagerFactory;

  @Override
  public List&lt;String&gt; listSensorsIds() {
    List&lt;String&gt; result = new ArrayList&lt;String&gt;();

    try {
      EntityManager em = entityManagerFactory.createEntityManager();
      TypedQuery&lt;String&gt; q = em.createQuery(&quot;SELECT s.id FROM JpaSensor s&quot;, String.class);

      result.addAll(q.getResultList());

      em.close();
    } catch (Exception e) {
      logger.log(Level.SEVERE, &quot;Error during sensors list retrieving&quot;, e);
    }

    return result;
  }
</pre>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Spring ORM</h2>
    </hgroup>
    <article class="smaller">
<pre class="prettyprint" data-lang="spring dm">
&lt;bean id=&quot;emf&quot; class=&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;&gt;
  &lt;property name=&quot;persistenceUnitName&quot; value=&quot;sensormix_db&quot; /&gt;
  &lt;property name=&quot;jpaVendorAdapter&quot;&gt;
    &lt;bean class=&quot;org.springframework.orm.jpa.vendor.EclipseLinkJpaVendorAdapter&quot;&gt;
      &lt;property name=&quot;showSql&quot; value=&quot;true&quot; /&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
  &lt;property name=&quot;jpaProperties&quot;&gt;
    &lt;props&gt;
      &lt;prop key=&quot;eclipselink.ddl-generation&quot;&gt;create-tables&lt;/prop&gt;
      &lt;prop key=&quot;eclipselink.logging.level&quot;&gt;INFO&lt;/prop&gt;
      &lt;prop key=&quot;eclipselink.weaving&quot;&gt;false&lt;/prop&gt;
      &lt;prop key=&quot;javax.persistence.jdbc.driver&quot;&gt;${sensormix_db.driverClassName}&lt;/prop&gt;
      &lt;prop key=&quot;javax.persistence.jdbc.url&quot;&gt;${sensormix_db.url}&lt;/prop&gt;
      &lt;prop key=&quot;javax.persistence.jdbc.user&quot;&gt;${sensormix_db.username}&lt;/prop&gt;
      &lt;prop key=&quot;javax.persistence.jdbc.password&quot;&gt;${sensormix_db.password}&lt;/prop&gt;
    &lt;/props&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=&quot;sensormixService&quot;
  class=&quot;com.google.developers.gdgfirenze.dataservice.SensormixServiceJpaImpl&quot;&gt;
  &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;emf&quot; /&gt;
&lt;/bean&gt;

</pre>
    </article>
  </slide>


  <!-- Integration -->
  <slide class="segue header-green no-back">
    <aside class="gdbar big-green"><img src="images/sensormix_focus_integration.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Integration Bundle</h2>
    </hgroup>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> Il bundle di integrazione</h2>
    </hgroup>
    <article>
      <p>Definisce le rotte Camel per l'ingresso dei campioni da Android, Arduino e iOS</p>
      <p>Utilizza quasi esclusivamente configurazione via Spring XML</p>
      <p>Unica eccezione: la classe <b>SampleAdapter</b> che trasforma da protocol buffer al nostro data model tramite codice java</p>
    </article>
  </slide>


  <slide class="header-green">
    <hgroup>
      <h2> Le rotta di ingresso UDP e HTTP </h2>
      <h3>Usate da Android e da Arduino</h3>
    </hgroup>
    <article>
<pre class="prettyprint" data-lang="spring xml">
&lt;route&gt;
  <b>&lt;from uri=&quot;mina2:udp://0.0.0.0:10081&quot; /&gt;</b>
  &lt;to uri=&quot;seda:jsonEntry&quot; /&gt;
&lt;/route&gt;
</pre>

<pre class="prettyprint" data-lang="spring xml">
&lt;route&gt;
  <b>&lt;from uri=&quot;jetty:http://0.0.0.0:10080/sensormixSamplesEndpoint&quot; /&gt;</b>
  &lt;to uri=&quot;seda:jsonEntry&quot; /&gt;

  &lt;setHeader headerName=&quot;Content-Type&quot;&gt;
    <b>&lt;constant&gt;application/json&lt;/constant&gt;</b>
  &lt;/setHeader&gt;
  <b>&lt;to uri=&quot;velocity:vm_templates/json_response_template.vm&quot; /&gt;</b>
&lt;/route&gt;
</pre>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> La rotta di trasformazione del JSON</h2>
    </hgroup>
    <article>
<pre class="prettyprint" data-lang="spring xml">
&lt;route&gt;
  &lt;from uri=&quot;seda:jsonEntry&quot; /&gt;
  &lt;convertBodyTo type=&quot;java.lang.String&quot; /&gt;

  &lt;unmarshal&gt;
    <b>&lt;xmljson elementName=&quot;item&quot; arrayName=&quot;list&quot; rootName=&quot;root&quot; /&gt;</b>
  &lt;/unmarshal&gt;

  <b>&lt;to uri=&quot;xslt:xslt_adapters/raw2cdm_adapter.xsl&quot; /&gt;</b>

  &lt;unmarshal&gt;
    <b>&lt;jaxb contextPath=&quot;com.google.developers.gdgfirenze.service&quot; /&gt;</b>
  &lt;/unmarshal&gt;

  &lt;to uri=&quot;seda:serviceEntry&quot; /&gt;
&lt;/route&gt;
</pre>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> La rotta TCP + ProtoBuf</h2>
    </hgroup>
    <article class="smaller">
<pre class="prettyprint" data-lang="spring xml">
<b>&lt;bean id=&quot;sampleAdapter&quot; 
  class=&quot;com.google.developers.gdgfirenze.integration.SampleAdapter&quot; /&gt;</b>

&lt;route&gt;
  <b>&lt;from uri=&quot;netty:tcp://0.0.0.0:10082/?decoders=#length-decoder&amp;amp;sync=false&quot; /&gt;</b>
  &lt;unmarshal&gt;
    <b>&lt;protobuf instanceClass=&quot;com.google.developers
      .gdgfirenze.protobuf.SensormixProtos$SampleMessage&quot; /&gt;</b>
  &lt;/unmarshal&gt;
  <b>&lt;bean ref=&quot;sampleAdapter&quot; method=&quot;transform&quot; /&gt;</b>
&lt;/route&gt;
</pre>
<pre class="prettyprint" data-lang="java">
<b>package com.google.developers.gdgfirenze.integration;</b>

public <b>class SampleAdapter</b> {
  public SamplesPayload transform(SampleMessage message) {
    SamplesPayload ret = new SamplesPayload();
    // process 'SampleMessage' and return the adapted 'SamplesPayload'
    return ret;
  }
}
</pre>
    </article>
  </slide>

  <slide class="header-green">
    <hgroup>
      <h2> L'output verso il servizio OSGi</h2>
    </hgroup>
    <article>
<pre class="prettyprint" data-lang="spring xml">
&lt;osgi:reference <b>id=&quot;sensormixService&quot;</b>
    interface=&quot;com.google.developers.gdgfirenze.service.SensormixService&quot;
    timeout=&quot;30000&quot; cardinality=&quot;1..1&quot; /&gt;

&lt;route&gt;
  &lt;from uri=&quot;seda:serviceEntry&quot; /&gt;
  <b>&lt;to uri=&quot;bean:sensormixService?method=recordSamples(${body.samples})&quot; /&gt;</b>
&lt;/route&gt;
</pre>

    </article>
  </slide>
  <!-- GWT -->
  <slide class="segue header-green no-back">
    <aside class="gdbar big-green"><img src="images/sensormix_focus_webapp.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Admin WebApp Bundle</h2>
    </hgroup>
  </slide>



  <slide class="logoslide dark nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/gdg_firenze_logo.png"></span>
    </article>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<script>

</script>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
